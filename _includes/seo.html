{% assign page_title = page.title | default: site.title %}
{% assign page_description = page.description | default: page.excerpt | default: site.description | strip_html | truncate: 160 %}
{% assign page_image = page.image | default: site.data.site.hero_image | default: site.data.bio.image %}
{% assign page_url = page.url | absolute_url %}

<!-- Canonical URL -->
<link rel="canonical" href="{{ page_url }}">

<!-- Open Graph / Facebook -->
<meta property="og:type" content="{% if page.layout == 'post' %}article{% else %}website{% endif %}">
<meta property="og:url" content="{{ page_url }}">
<meta property="og:title" content="{{ page_title }} | {{ site.data.site.title }}">
<meta property="og:description" content="{{ page_description }}">
{% if page_image %}<meta property="og:image" content="{% if page_image contains 'http' %}{{ page_image }}{% else %}{{ page_image | absolute_url }}{% endif %}">{% endif %}
<meta property="og:site_name" content="{{ site.data.site.title }}">
<meta property="og:locale" content="en_US">

<!-- Twitter Card -->
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:url" content="{{ page_url }}">
<meta name="twitter:title" content="{{ page_title }} | {{ site.data.site.title }}">
<meta name="twitter:description" content="{{ page_description }}">
{% if page_image %}<meta name="twitter:image" content="{% if page_image contains 'http' %}{{ page_image }}{% else %}{{ page_image | absolute_url }}{% endif %}">{% endif %}

<!-- Additional SEO -->
<meta name="robots" content="index, follow">
<meta name="author" content="{{ site.data.site.title }}">
{% if page.date %}<meta property="article:published_time" content="{{ page.date | date_to_xmlschema }}">{% endif %}

<!-- JSON-LD Structured Data -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "MusicGroup",
  "name": "{{ site.data.site.title }}",
  "description": "{{ site.description }}",
  "url": "{{ site.url }}{{ site.baseurl }}/",
  "genre": ["Progressive Jazz", "Jazz Rock", "Fusion"],
  "foundingLocation": {
    "@type": "Place",
    "name": "San Jose, California"
  },
  {% if site.data.bio.image %}"image": "{{ site.data.bio.image }}",{% endif %}
  "member": [
    {% for member in site.data.bio.members %}
    {
      "@type": "Person",
      "name": "{{ member.name }}",
      "roleName": "{{ member.role }}"
    }{% unless forloop.last %},{% endunless %}
    {% endfor %}
  ]{% if site.data.albums.size > 0 %},
  "album": [
    {% for album in site.data.albums %}
    {
      "@type": "MusicAlbum",
      "name": "{{ album.title }}",
      "datePublished": "{{ album.year }}",
      "byArtist": {
        "@type": "MusicGroup",
        "name": "{{ album.artist }}"
      }
    }{% unless forloop.last %},{% endunless %}
    {% endfor %}
  ]{% endif %}{% if site.data.site.social.spotify %},
  "sameAs": [
    {% if site.data.site.social.spotify %}"{{ site.data.site.social.spotify }}"{% endif %}{% if site.data.site.social.instagram %},
    "{{ site.data.site.social.instagram }}"{% endif %}{% if site.data.site.social.facebook %},
    "{{ site.data.site.social.facebook }}"{% endif %}{% if site.data.site.social.youtube %},
    "{{ site.data.site.social.youtube }}"{% endif %}{% if site.data.site.social.twitter %},
    "{{ site.data.site.social.twitter }}"{% endif %}
  ]{% endif %}
}
</script>

{% if page.layout == 'post' %}
<!-- Article Structured Data for blog posts -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "{{ page.title }}",
  "description": "{{ page_description }}",
  "datePublished": "{{ page.date | date_to_xmlschema }}",
  "author": {
    "@type": "MusicGroup",
    "name": "{{ site.data.site.title }}"
  },
  "publisher": {
    "@type": "Organization",
    "name": "{{ site.data.site.title }}"
  }{% if page.image %},
  "image": "{{ page.image }}"{% endif %}
}
</script>
{% endif %}
